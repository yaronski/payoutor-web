# Payoutor Implementation Plan: GitHub & Google Sheets Integration

## Overview

This document outlines the plan to extend Payoutor with features that automate documentation for:
1. **GitHub Treasury Repo** (`moonbeam-foundation/treasury`) - Generate properly formatted .md files and README.md table entries
2. **Google Sheets** - Generate preformatted rows for easy copy-paste into tracking spreadsheets

---

## Current Manual Workflow

### GitHub Treasury Repo
1. After a payout is processed, manually:
   - Create a new `.md` file in `/moonbeam/` or `/moonriver/` folder
   - File naming: `MBTP{proposalId}&MRTP{proposalId}.md` (for combined proposals) or `MBTP{proposalId}.md` / `MRTP{proposalId}.md`
   - The .md file is a copy-paste of the forum post (often with broken markdown)
   - Add a new row to the README.md table with: Proposal ID, Motion ID, Title (with link), Proposed By, Beneficiary, Reward, Status

### Google Sheets
- Two tabs: "Moonbeam" and "Moonriver"
- Columns: `Proposal ID | Motion ID | Type | Submission Address | Beneficiary Address | GitHub URL | Proposal Hash | Closing Result | Closing Block | Awarded Date | Quarter | Label | Category | Net Tokens | Returned Tokens | Total USD Requested | GLMR Proportion | GLMR USD`
- Manually enter all data after payout

---

## Proposed Implementation

### 1. Google Sheets Integration

**Approach:** Generate a tab-separated (or comma-separated) row that can be copied and pasted directly into the spreadsheet.

**UI Addition:**
- New step "7. Export Data" after "6. Claim Funds"
- Two buttons: "Copy Moonbeam Row" and "Copy Moonriver Row" (or one combined for native payouts)
- For USDC payouts: only Moonbeam row

**Data Format (tab-separated for direct paste):**
```
{proposalId}\t{motionId}\tapproveProposal\t{submissionAddress}\t{beneficiaryAddress}\t{githubUrl}\t{proposalHash}\tAye\t{closingBlock}\t{awardedDate}\t{quarter}\t{label}\t{category}\t{netTokens}\t{returnedTokens}\t{totalUsd}\t{glmrProportion}\t{glmrUsd}
```

**Required Fields:**
| Field | Source | Notes |
|-------|--------|-------|
| Proposal ID | From chain (moonbeamProposalIndex/moonriverProposalIndex) | |
| Motion ID | Same as Proposal ID for treasury.spend flow | |
| Type | Always `approveProposal` | |
| Submission Address | The council member who submitted | Need new input field |
| Beneficiary Address | Recipient address | Already have |
| GitHub URL | Constructed from proposal ID | `https://github.com/moonbeam-foundation/treasury/blob/main/{folder}/{filename}.md` |
| Proposal Hash | From call data | Already have (treasuryCallHash) |
| Closing Result | `Aye` (default, editable) | |
| Closing Block | Fetched after close | Need to fetch or manual entry |
| Awarded Date | Current date | Auto-generated |
| Quarter | Calculated from date | Q1/Q2/Q3/Q4 |
| Label | User input | New field - project name |
| Category | User input | New field - e.g., "Wallet", "Infrastructure", etc. |
| Net Tokens | Token amount | Already calculated |
| Returned Tokens | Usually 0 | Default 0 |
| Total USD Requested | usdAmount | Already have |
| GLMR Proportion | For native: glmrRatio | Already have |
| GLMR USD | For native: glmrUsd | Already calculated |

**New Input Fields Needed:**
- "Submission Address" (address of council member submitting)
- "Project Label" (short name for the project)
- "Category" (dropdown: Infrastructure, Wallet, Tooling, etc.)

---

### 2. GitHub Treasury Repo Integration

**Approach:** Accept a forum URL, scrape the content, and generate:
1. Properly formatted `.md` files for moonbeam/moonriver folders
2. README.md table row(s) ready for insertion

**UI Addition:**
- New input field: "Forum Post URL" (optional)
- New step "8. Generate GitHub Docs" with:
  - Preview of the .md content
  - "Copy Moonbeam .md" / "Copy Moonriver .md" buttons
  - "Copy README Row" button(s)

**File Naming Convention:**
- Single network: `MBTP{proposalId}.md` or `MRTP{proposalId}.md`
- Combined (native payout to same beneficiary): `MBTP{mbId}&MRTP{mrId}.md`

**Generated .md Structure:**
```markdown
# [{Title}]({forumUrl})

{Cleaned forum content with proper markdown formatting}

---
*Generated by Payoutor on {date}*
*Proposal Hash: {hash}*
*Beneficiary: {address}*
*Reward: {amount} {token}*
```

**README Table Row Format:**
```markdown
| {proposalId} | {motionId} | [{Title}](moonbeam/MBTP{id}.md) | {submissionAddress} | {beneficiary} | {reward} {token} | approved |
```

---

## Implementation Phases

### Phase 1: Google Sheets Export (Simpler, no external dependencies)
1. Add new input fields: Submission Address, Project Label, Category
2. Add "7. Export for Google Sheets" step
3. Generate tab-separated row(s) with all required columns
4. Copy-to-clipboard functionality

### Phase 2: GitHub Documentation Generator
1. Add "Forum Post URL" input field
2. Create API endpoint to fetch and parse forum content
   - Handle Discourse forum format
   - Clean up broken markdown
   - Extract title, content, images
3. Generate properly formatted .md files
4. Generate README.md table rows
5. Preview and copy functionality

### Phase 3: Enhanced Features (Optional)
- Auto-detect quarter from date
- Category suggestions based on project name
- Bulk export for multiple proposals
- Direct GitHub API integration (would require auth)

---

## Technical Considerations

### Forum Scraping
- Moonbeam forum is Discourse-based
- May need to handle rate limiting
- Images should be preserved as URLs (not embedded)
- Handle code blocks, tables, and special formatting

### Data Storage
- All additional fields stored in result state
- Export formats generated on-demand (not stored)

### Error Handling
- Forum URL validation
- Graceful fallback if scraping fails
- User can manually enter title if scraping fails

---

## UI Mockup (Text)

```
┌─────────────────────────────────────────────────────────┐
│ 7. Export Data                                          │
├─────────────────────────────────────────────────────────┤
│ Google Sheets                                           │
│ [Copy Moonbeam Row] [Copy Moonriver Row]               │
│                                                         │
│ GitHub Documentation                                    │
│ Forum URL: [https://forum.moonbeam.network/t/...]      │
│ [Fetch & Generate]                                      │
│                                                         │
│ Generated Files:                                        │
│ ┌─────────────────────────────────────────────────┐    │
│ │ MBTP63&MRTP60.md                                 │    │
│ │ [Preview] [Copy .md] [Download]                  │    │
│ └─────────────────────────────────────────────────┘    │
│                                                         │
│ README Row:                                             │
│ | 63 | 63 | [Title](...) | 0x... | 0x... | 1000 GLMR | │
│ [Copy Moonbeam Row] [Copy Moonriver Row]               │
└─────────────────────────────────────────────────────────┘
```

---

## Next Steps

1. **Confirm Requirements:**
   - Verify all Google Sheets columns are needed
   - Confirm file naming convention preferences
   - Decide on Phase 1 vs full implementation

2. **Phase 1 Implementation:**
   - Add input fields
   - Implement row generation
   - Test copy-paste into Google Sheets

3. **Phase 2 Implementation:**
   - Research Discourse API/scraping approach
   - Build forum content fetcher
   - Generate .md files
   - Generate README rows

4. **Testing:**
   - Test with real proposal data
   - Verify paste works in Google Sheets
   - Verify generated .md renders correctly on GitHub
